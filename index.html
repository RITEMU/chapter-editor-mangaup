<!DOCTYPE html><html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مبدل تصویر به WebP</title>
<style>
body {
font-family: system-ui;
background: #f0f0f0;
padding: 20px;
text-align: center;
}
.container {
max-width: 600px;
margin: 0 auto;
background: white;
padding: 20px;
border-radius: 10px;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.upload-btn {
background: #4CAF50;
color: white;
padding: 10px 20px;
border: none;
border-radius: 5px;
cursor: pointer;
margin: 10px;
font-size: 16px;
}
.preview {
max-width: 100%;
margin: 20px 0;
}
#result {
margin: 20px 0;
font-weight: bold;
}
.download-btn {
background: #2196F3;
color: white;
padding: 10px 20px;
border: none;
border-radius: 5px;
cursor: pointer;
text-decoration: none;
display: inline-block;
margin: 10px;
}
#progress {
width: 100%;
height: 20px;
background-color: #f0f0f0;
border-radius: 10px;
margin: 10px 0;
overflow: hidden;
display: none;
}
#progress-bar {
width: 0%;
height: 100%;
background-color: #4CAF50;
transition: width 0.3s;
}
</style>
</head>
<body>
<div class="container">
<h1>تبدیل عکس به فرمت WebP</h1>
<p>عکستو انتخاب کن تا برات تبدیلش کنم!</p>
<input type="file" id="imageInput" accept="image/*" style="display: none" multiple>
<button class="upload-btn" onclick="document.getElementById('imageInput').click()">انتخاب عکس</button>
<div id="progress">
<div id="progress-bar"></div>
</div>
<div id="result"></div>
<img id="preview" class="preview" style="display: none">
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/browser-image-compression/2.0.1/browser-image-compression.min.js"></script>
<script>
const imageInput = document.getElementById('imageInput');
const preview = document.getElementById('preview');
const result = document.getElementById('result');
const progress = document.getElementById('progress');
const progressBar = document.getElementById('progress-bar');

imageInput.addEventListener('change', async function(e) {
const files = e.target.files;

for(let file of files) {
if (!file.type.startsWith('image/')) {
result.textContent = 'لطفاً فقط فایل تصویری انتخاب کن!';
return;
}

progress.style.display = 'block';
result.textContent = 'در حال تبدیل...';

try {
// نمایش پیش‌نمایش
preview.src = URL.createObjectURL(file);
preview.style.display = 'block';

// تنظیمات فشرده‌سازی
const options = {
maxSizeMB: 10,
maxWidthOrHeight: 4096,
useWebWorker: true,
onProgress: (progress) => {
progressBar.style.width = progress * 100 + '%';
}
};

// تبدیل به WebP
const compressedFile = await imageCompression(file, options);

// ایجاد لینک دانلود
const url = URL.createObjectURL(compressedFile);
const link = document.createElement('a');
link.href = url;
link.download = file.name.replace(/\.[^/.]+$/, '') + '.webp';
link.className = 'download-btn';
link.textContent = 'دانلود تصویر WebP';

result.textContent = 'تبدیل با موفقیت انجام شد!';
result.appendChild(document.createElement('br'));
result.appendChild(link);

} catch (error) {
result.textContent = 'خطا در تبدیل فایل: ' + error.message;
}

progress.style.display = 'none';
progressBar.style.width = '0%';
}
});
</script>
</body>
</html>
