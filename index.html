<!DOCTYPE html><html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>پردازشگر تصویر</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
:root {
--primary: #2563eb;
--primary-hover: #1d4ed8;
--bg: #f8fafc;
--border: #e2e8f0;
--error: #ef4444;
--success: #22c55e;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: system-ui, -apple-system, sans-serif;
}

body {
background: var(--bg);
padding: 2rem;
min-height: 100vh;
}

.container {
max-width: 800px;
margin: 0 auto;
background: white;
padding: 2rem;
border-radius: 1rem;
box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
}

.form-group {
margin-bottom: 1.5rem;
}

label {
display: block;
margin-bottom: 0.5rem;
font-weight: 500;
}

input[type="number"],
input[type="range"],
select {
width: 100%;
padding: 0.5rem;
border: 1px solid var(--border);
border-radius: 0.5rem;
font-size: 1rem;
}

.alert {
padding: 1rem;
border-radius: 0.5rem;
margin-bottom: 1rem;
display: none;
}

.alert-error {
background: #fef2f2;
color: var(--error);
border: 1px solid #fee2e2;
}

.alert-success {
background: #f0fdf4;
color: var(--success);
border: 1px solid #dcfce7;
}

button {
background: var(--primary);
color: white;
border: none;
padding: 0.75rem 1.5rem;
border-radius: 0.5rem;
font-weight: 500;
cursor: pointer;
width: 100%;
font-size: 1rem;
}

button:disabled {
opacity: 0.5;
cursor: not-allowed;
}

.progress-container {
margin-top: 1rem;
}

.progress {
width: 100%;
height: 0.5rem;
background: var(--border);
border-radius: 0.25rem;
overflow: hidden;
}

.progress-bar {
height: 100%;
width: 0;
background: var(--primary);
transition: width 0.3s ease;
}

.status {
text-align: center;
margin-top: 0.5rem;
font-size: 0.875rem;
}
</style>
</head>
<body>
<div class="container">
<h1>پردازشگر تصویر</h1>

<div id="errorAlert" class="alert alert-error"></div>
<div id="successAlert" class="alert alert-success"></div>

<div class="form-group">
<label>انتخاب پوشه تصاویر</label>
<input type="file" id="fileInput" webkitdirectory directory multiple accept="image/*">
</div>

<div class="form-group">
<label>فرمت خروجی</label>
<select id="formatSelect">
<option value="webp">WebP</option>
<option value="jpeg">JPEG</option>
<option value="png">PNG</option>
</select>
</div>

<div class="form-group">
<label>کیفیت تصویر</label>
<input type="range" id="qualityInput" min="1" max="100" value="80">
<span id="qualityValue">80%</span>
</div>

<div class="form-group">
<label>عرض تصویر (پیکسل)</label>
<input type="number" id="widthInput" min="1" placeholder="اختیاری">
</div>

<div class="form-group">
<label>حداکثر ارتفاع تصویر (پیکسل)</label>
<input type="number" id="maxHeightInput" min="1" placeholder="اختیاری">
</div>

<button id="processButton" disabled>پردازش تصاویر</button>

<div class="progress-container" style="display: none;">
<div class="progress">
<div class="progress-bar"></div>
</div>
<div class="status"></div>
</div>
</div>

<script>
class ImageProcessor {
constructor() {
this.initializeElements();
this.setupEventListeners();
this.files = [];
this.processing = false;
}

initializeElements() {
this.fileInput = document.getElementById('fileInput');
this.formatSelect = document.getElementById('formatSelect');
this.qualityInput = document.getElementById('qualityInput');
this.qualityValue = document.getElementById('qualityValue');
this.widthInput = document.getElementById('widthInput');
this.maxHeightInput = document.getElementById('maxHeightInput');
this.processButton = document.getElementById('processButton');
this.progressContainer = document.querySelector('.progress-container');
this.progressBar = document.querySelector('.progress-bar');
this.status = document.querySelector('.status');
this.errorAlert = document.getElementById('errorAlert');
this.successAlert = document.getElementById('successAlert');
}

setupEventListeners() {
this.fileInput.addEventListener('change', () => this.handleFileSelect());
this.qualityInput.addEventListener('input', () => this.updateQualityValue());
this.processButton.addEventListener('click', () => this.startProcessing());
}

showError(message) {
this.errorAlert.textContent = message;
this.errorAlert.style.display = 'block';
setTimeout(() => {
this.errorAlert.style.display = 'none';
}, 5000);
}

showSuccess(message) {
this.successAlert.textContent = message;
this.successAlert.style.display = 'block';
setTimeout(() => {
this.successAlert.style.display = 'none';
}, 5000);
}

handleFileSelect() {
try {
this.files = Array.from(this.fileInput.files).filter(file => 
file.type.startsWith('image/')
);

if (this.files.length === 0) {
this.showError('لطفاً حداقل یک تصویر انتخاب کنید.');
this.processButton.disabled = true;
return;
}

this.processButton.disabled = false;
this.showSuccess(`${this.files.length} تصویر انتخاب شد.`);
} catch (error) {
this.showError('خطا در انتخاب فایل‌ها: ' + error.message);
}
}

updateQualityValue() {
this.qualityValue.textContent = `${this.qualityInput.value}%`;
}

async startProcessing() {
if (this.processing) return;

try {
this.processing = true;
this.processButton.disabled = true;
this.progressContainer.style.display = 'block';

const zip = new JSZip();
let processed = 0;

for (const file of this.files) {
try {
const processedImage = await this.processImage(file);
zip.file(file.name, processedImage);

processed++;
const progress = (processed / this.files.length) * 100;
this.updateProgress(progress, `پردازش ${processed} از ${this.files.length}`);
} catch (error) {
console.error(`خطا در پردازش ${file.name}:`, error);
this.showError(`خطا در پردازش ${file.name}`);
}
}

const content = await zip.generateAsync({type: 'blob'});
this.downloadFile(content, 'processed_images.zip');

this.showSuccess('پردازش با موفقیت انجام شد.');
} catch (error) {
this.showError('خطا در پردازش تصاویر: ' + error.message);
} finally {
this.processing = false;
this.processButton.disabled = false;
setTimeout(() => {
this.progressContainer.style.display = 'none';
this.updateProgress(0, '');
}, 2000);
}
}

async processImage(file) {
return new Promise((resolve, reject) => {
const reader = new FileReader();
reader.onload = async (e) => {
try {
const img = new Image();
img.src = e.target.result;

await new Promise((res) => {
img.onload = res;
img.onerror = reject;
});

const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');

let width = img.width;
let height = img.height;

if (this.widthInput.value) {
width = parseInt(this.widthInput.value);
height = (width / img.width) * img.height;
}

if (this.maxHeightInput.value && height > parseInt(this.maxHeightInput.value)) {
height = parseInt(this.maxHeightInput.value);
width = (height / img.height) * img.width;
}

canvas.width = width;
canvas.height = height;
ctx.drawImage(img, 0, 0, width, height);

canvas.toBlob(
(blob) => resolve(blob),
`image/${this.formatSelect.value}`,
parseInt(this.qualityInput.value) / 100
);
} catch (error) {
reject(error);
}
};
reader.onerror = reject;
reader.readAsDataURL(file);
});
}

updateProgress(percent, status) {
this.progressBar.style.width = `${percent}%`;
this.status.textContent = status;
}

downloadFile(content, filename) {
const url = URL.createObjectURL(content);
const link = document.createElement('a');
link.href = url;
link.download = filename;
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
URL.revokeObjectURL(url);
}
}

// Initialize the application
const processor = new ImageProcessor();
</script>
</body>
</html>
