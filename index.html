<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>پردازشگر تصویر</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<style>
:root {
--primary: #2563eb;
--primary-hover: #1d4ed8;
--bg: #1a1a1a;
--text: #ffffff;
--border: #333333;
--card-bg: #242424;
}

.dark-mode {
--primary: #3b82f6;
--primary-hover: #60a5fa;
--bg: #1a1a1a;
--text: #ffffff;
--border: #333333;
--card-bg: #242424;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: system-ui, -apple-system, sans-serif;
}

body {
background: var(--bg);
color: var(--text);
padding: 2rem;
min-height: 100vh;
}

.container {
max-width: 800px;
margin: 0 auto;
background: var(--card-bg);
padding: 2rem;
border-radius: 1rem;
box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
}

.form-group {
margin-bottom: 1.5rem;
}

label {
display: block;
margin-bottom: 0.5rem;
font-weight: 500;
}

input[type="number"],
input[type="range"],
select {
width: 100%;
padding: 0.5rem;
border: 1px solid var(--border);
border-radius: 0.5rem;
font-size: 1rem;
background: var(--bg);
color: var(--text);
}

button {
background: var(--primary);
color: white;
border: none;
padding: 0.75rem 1.5rem;
border-radius: 0.5rem;
font-weight: 500;
cursor: pointer;
width: 100%;
font-size: 1rem;
}

button:hover {
background: var(--primary-hover);
}

button:disabled {
opacity: 0.5;
cursor: not-allowed;
}

.folders-container {
margin-top: 1rem;
}

.folder {
background: var(--bg);
border: 1px solid var(--border);
border-radius: 0.5rem;
padding: 1rem;
margin-bottom: 1rem;
}

.folder-name {
font-weight: bold;
margin-bottom: 0.5rem;
color: var(--primary);
}

.files-list {
padding-right: 1.5rem;
}

.file-item {
padding: 0.3rem;
cursor: move;
user-select: none;
border: 1px solid transparent;
}

.file-item:hover {
background: var(--border);
border-radius: 0.3rem;
}

.progress-container {
margin-top: 1.5rem;
display: none;
}

.progress-info {
display: flex;
justify-content: space-between;
margin-bottom: 0.5rem;
}

.progress-bar {
height: 0.5rem;
background: var(--border);
border-radius: 1rem;
overflow: hidden;
position: relative;
}

.progress-fill {
position: absolute;
top: 0;
left: 0;
height: 100%;
background: linear-gradient(90deg, var(--primary) 0%, var(--primary-hover) 100%);
transition: width 0.3s ease;
border-radius: 1rem;
}

.status {
margin-top: 1rem;
text-align: center;
color: var(--text);
font-weight: 500;
}
</style>
</head>
<div class="container">
<div class="form-group">
<label>انتخاب پوشه‌ها</label>
<input type="file" id="fileInput" webkitdirectory directory multiple>
</div>

<div class="folders-container" id="foldersContainer"></div>

<div class="form-group">
<label>عرض (پیکسل)</label>
<input type="number" id="widthInput" value="800" min="1" max="10000">
</div>

<div class="form-group">
<label>حداکثر طول (پیکسل)</label>
<input type="number" id="maxHeightInput" value="14000" min="1" max="20000">
</div>

<div class="form-group">
<label>فرمت خروجی</label>
<select id="formatSelect">
<option value="webp">WebP</option>
<option value="jpeg">JPEG</option>
<option value="png">PNG</option>
</select>
</div>

<div class="form-group">
<label>کیفیت: <span id="qualityValue">100</span>%</label>
<input type="range" id="qualityInput" min="1" max="100" value="100">
</div>

<button id="processButton">شروع پردازش</button>

<div class="progress-container" id="progressContainer">
<div class="progress-info">
<span id="progressText">0%</span>
<span id="progressStatus">در حال آماده‌سازی...</span>
</div>
<div class="progress-bar">
<div class="progress-fill" id="progressFill"></div>
</div>
</div>

<div class="status" id="statusText"></div>
</div>

<script>
// کد قبلی همگی حفظ شده و فقط تغییرات جدید اضافه میشن

let files = new Map();
let sortables = new Map();

fileInput.addEventListener('change', () => {
files.clear();
foldersContainer.innerHTML = '';

Array.from(fileInput.files)
.filter(file => file.type.startsWith('image/'))
.forEach(file => {
const [folderPath, ...subPath] = file.webkitRelativePath.split('/');
if (!files.has(folderPath)) {
files.set(folderPath, []);
}
files.get(folderPath).push(file);
});

updateFoldersView();
});

function updateFoldersView() {
foldersContainer.innerHTML = '';
files.forEach((folderFiles, folderName) => {
const folderDiv = document.createElement('div');
folderDiv.className = 'folder';

const folderNameDiv = document.createElement('div');
folderNameDiv.className = 'folder-name';
folderNameDiv.textContent = `${folderName}/`;

const filesList = document.createElement('div');
filesList.className = 'files-list';

folderFiles.sort((a, b) => a.name.localeCompare(b.name))
.forEach(file => {
const fileItem = document.createElement('div');
fileItem.className = 'file-item';
fileItem.textContent = `├── ${file.name}`;
fileItem.dataset.fileName = file.name;
filesList.appendChild(fileItem);
});

folderDiv.appendChild(folderNameDiv);
folderDiv.appendChild(filesList);
foldersContainer.appendChild(folderDiv);

// اضافه کردن قابلیت جابجایی
sortables.set(folderName, new Sortable(filesList, {
animation: 150,
onEnd: function(evt) {
const folderFiles = Array.from(files.get(folderName));
const movedFile = folderFiles.splice(evt.oldIndex, 1)[0];
folderFiles.splice(evt.newIndex, 0, movedFile);
files.set(folderName, folderFiles);
}
}));
});
}

function updateProgress(ratio, status = '') {
const progressContainer = document.getElementById('progressContainer');
const progressFill = document.getElementById('progressFill');
const progressText = document.getElementById('progressText');
const progressStatus = document.getElementById('progressStatus');

progressContainer.style.display = 'block';
progressFill.style.width = `${ratio * 100}%`;
progressText.textContent = `${Math.round(ratio * 100)}%`;
if (status) {
progressStatus.textContent = status;
}
}

// اضافه کردن سایر توابع قبلی بدون تغییر
// ...

</script>
</body>
</html>
