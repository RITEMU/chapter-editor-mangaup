<!DOCTYPE html><html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>پردازشگر تصاویر مانگا</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
:root {
--primary-color: #4a90e2;
--secondary-color: #f5f5f5;
--border-radius: 8px;
--spacing: 1rem;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: system-ui, -apple-system, sans-serif;
}

body {
background-color: #f0f2f5;
padding: 2rem;
min-height: 100vh;
}

.container {
max-width: 800px;
margin: 0 auto;
background: white;
padding: 2rem;
border-radius: var(--border-radius);
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.form-group {
margin-bottom: var(--spacing);
}

.form-row {
display: flex;
align-items: center;
gap: 1rem;
margin-bottom: 1rem;
}

label {
flex: 0 0 120px;
color: #333;
}

input[type="text"],
input[type="number"],
select {
flex: 1;
padding: 0.5rem;
border: 1px solid #ddd;
border-radius: var(--border-radius);
font-size: 1rem;
}

button {
background-color: var(--primary-color);
color: white;
border: none;
padding: 1rem 2rem;
border-radius: var(--border-radius);
cursor: pointer;
font-size: 1rem;
width: 100%;
transition: background-color 0.2s;
}

button:hover {
background-color: #357abd;
}

button:disabled {
background-color: #ccc;
cursor: not-allowed;
}

.progress-container {
margin: 1rem 0;
background-color: var(--secondary-color);
border-radius: var(--border-radius);
overflow: hidden;
}

.progress-bar {
height: 20px;
background-color: var(--primary-color);
width: 0%;
transition: width 0.3s ease;
}

.status {
text-align: center;
margin: 1rem 0;
padding: 0.5rem;
border-radius: var(--border-radius);
background-color: var(--secondary-color);
}

.file-input {
display: none;
}

.checkbox-wrapper {
display: flex;
align-items: center;
gap: 0.5rem;
}

.selected-files {
margin: 1rem 0;
padding: 0.5rem;
background-color: var(--secondary-color);
border-radius: var(--border-radius);
}
</style>
</head>
<body>
<div class="container">
<h1 style="margin-bottom: 2rem; text-align: center;">پردازشگر تصاویر مانگا</h1>

<div class="form-group">
<button id="fileSelect">انتخاب فایل‌ها</button>
<input type="file" id="fileInput" class="file-input" multiple accept=".jpg,.jpeg,.png,.webp">
<div id="selectedFiles" class="selected-files">هیچ فایلی انتخاب نشده</div>
</div>

<div class="form-row">
<label>عرض تصویر:</label>
<input type="number" id="width" value="800" min="1">
</div>

<div class="form-row">
<label>حداکثر طول:</label>
<input type="number" id="height" value="12000" min="1">
</div>

<div class="form-row">
<label>فرمت خروجی:</label>
<select id="format">
<option value="jpg">JPG</option>
<option value="png">PNG</option>
<option value="webp">WebP</option>
</select>
</div>

<div class="form-row">
<label>کیفیت (%):</label>
<input type="number" id="quality" value="100" min="1" max="100">
</div>

<div class="form-row">
<label>زیپ کردن خروجی:</label>
<div class="checkbox-wrapper">
<input type="checkbox" id="zip">
</div>
</div>

<div class="status" id="status">آماده برای پردازش</div>

<div class="progress-container">
<div class="progress-bar" id="progress"></div>
</div>

<button id="process">شروع پردازش</button>
</div>

<script>
const fileSelect = document.getElementById('fileSelect');
const fileInput = document.getElementById('fileInput');
const selectedFiles = document.getElementById('selectedFiles');
const processButton = document.getElementById('process');
const status = document.getElementById('status');
const progress = document.getElementById('progress');

fileSelect.addEventListener('click', () => fileInput.click());

fileInput.addEventListener('change', () => {
const files = Array.from(fileInput.files);
selectedFiles.textContent = files.length > 0 
? `${files.length} فایل انتخاب شده` 
: 'هیچ فایلی انتخاب نشده';
});

async function processImages() {
const files = fileInput.files;
if (!files.length) {
status.textContent = 'لطفاً ابتدا فایل‌ها را انتخاب کنید';
return;
}

processButton.disabled = true;
const targetWidth = parseInt(document.getElementById('width').value);
const maxHeight = parseInt(document.getElementById('height').value);
const quality = parseInt(document.getElementById('quality').value);
const outputFormat = document.getElementById('format').value;
const shouldZip = document.getElementById('zip').checked;

const processedImages = [];
let processed = 0;

for (const file of files) {
try {
status.textContent = `در حال پردازش: ${file.name}`;

const img = new Image();
const imageUrl = URL.createObjectURL(file);

await new Promise((resolve, reject) => {
img.onload = resolve;
img.onerror = reject;
img.src = imageUrl;
});

const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');

const ratio = targetWidth / img.width;
let newHeight = img.height * ratio;
newHeight = Math.min(newHeight, maxHeight);

canvas.width = targetWidth;
canvas.height = newHeight;

ctx.drawImage(img, 0, 0, targetWidth, newHeight);

const processedImage = await new Promise(resolve => {
canvas.toBlob(blob => {
resolve({
name: file.name.replace(/\.[^/.]+$/, '') + '.' + outputFormat,
blob
});
}, `image/${outputFormat}`, quality / 100);
});

processedImages.push(processedImage);
processed++;
progress.style.width = `${(processed / files.length) * 100}%`;

URL.revokeObjectURL(imageUrl);
} catch (error) {
console.error(`Error processing ${file.name}:`, error);
status.textContent = `خطا در پردازش ${file.name}`;
}
}

if (shouldZip) {
status.textContent = 'در حال ساخت فایل زیپ...';
const zip = new JSZip();

processedImages.forEach(image => {
zip.file(image.name, image.blob);
});

const zipBlob = await zip.generateAsync({ type: 'blob' });
const downloadUrl = URL.createObjectURL(zipBlob);

const a = document.createElement('a');
a.href = downloadUrl;
a.download = `manga_processed_${new Date().getTime()}.zip`;
a.click();

URL.revokeObjectURL(downloadUrl);
} else {
processedImages.forEach(image => {
const downloadUrl = URL.createObjectURL(image.blob);
const a = document.createElement('a');
a.href = downloadUrl;
a.download = image.name;
a.click();
URL.revokeObjectURL(downloadUrl);
});
}

status.textContent = 'پردازش با موفقیت انجام شد';
processButton.disabled = false;
progress.style.width = '0%';
}

processButton.addEventListener('click', processImages);
</script>
</body>
</html>
