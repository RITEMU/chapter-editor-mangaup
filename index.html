<!DOCTYPE html><html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>پردازشگر تصاویر مانگا</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
:root {
--primary-color: #4a90e2;
--secondary-color: #f5f5f5;
--border-radius: 8px;
--spacing: 1rem;
}

* {
box-sizing: border-box;
margin: 0;
padding: 0;
font-family: system-ui, -apple-system, sans-serif;
}

body {
background-color: #f0f2f5;
padding: 2rem;
max-width: 800px;
margin: 0 auto;
}

.container {
background-color: white;
padding: 2rem;
border-radius: var(--border-radius);
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.form-group {
margin-bottom: var(--spacing);
}

label {
display: block;
margin-bottom: 0.5rem;
color: #333;
font-weight: 500;
}

input[type="number"],
input[type="text"],
select {
width: 100%;
padding: 0.75rem;
border: 1px solid #ddd;
border-radius: var(--border-radius);
font-size: 1rem;
}

button {
background-color: var(--primary-color);
color: white;
border: none;
padding: 1rem 2rem;
border-radius: var(--border-radius);
cursor: pointer;
font-size: 1rem;
width: 100%;
transition: background-color 0.2s;
}

button:hover {
background-color: #357abd;
}

button:disabled {
background-color: #ccc;
cursor: not-allowed;
}

.progress-container {
margin: var(--spacing) 0;
background-color: var(--secondary-color);
border-radius: var(--border-radius);
overflow: hidden;
}

.progress-bar {
height: 20px;
background-color: var(--primary-color);
width: 0%;
transition: width 0.3s ease;
}

.status {
text-align: center;
margin: var(--spacing) 0;
color: #666;
}

.checkbox-group {
display: flex;
align-items: center;
gap: 0.5rem;
}

.file-list {
margin: var(--spacing) 0;
padding: var(--spacing);
background-color: var(--secondary-color);
border-radius: var(--border-radius);
min-height: 50px;
}

#dropZone {
border: 2px dashed #ccc;
padding: 2rem;
text-align: center;
margin-bottom: var(--spacing);
border-radius: var(--border-radius);
cursor: pointer;
transition: border-color 0.2s;
}

#dropZone.drag-over {
border-color: var(--primary-color);
background-color: rgba(74, 144, 226, 0.1);
}
</style>
</head>
<body>
<div class="container">
<h1 style="margin-bottom: 2rem; text-align: center;">پردازشگر تصاویر مانگا</h1>

<div id="dropZone">
فایل‌ها را اینجا رها کنید یا کلیک کنید
<input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
</div>

<div id="fileList" class="file-list">
هیچ فایلی انتخاب نشده
</div>

<div class="form-group">
<label>عرض تصویر (پیکسل)</label>
<input type="number" id="width" value="800" min="1">
</div>

<div class="form-group">
<label>حداکثر طول (پیکسل)</label>
<input type="number" id="height" value="12000" min="1">
</div>

<div class="form-group">
<label>فرمت خروجی</label>
<select id="format">
<option value="image/jpeg">JPG</option>
<option value="image/png">PNG</option>
<option value="image/webp">WebP</option>
</select>
</div>

<div class="form-group">
<label>کیفیت (%)</label>
<input type="number" id="quality" value="100" min="1" max="100">
</div>

<div class="form-group checkbox-group">
<input type="checkbox" id="zip">
<label for="zip">زیپ کردن خروجی</label>
</div>

<div class="progress-container">
<div class="progress-bar" id="progress"></div>
</div>

<div class="status" id="status">آماده برای پردازش</div>

<button id="processButton" disabled>شروع پردازش</button>
</div>

<script>
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const fileList = document.getElementById('fileList');
const processButton = document.getElementById('processButton');
const progressBar = document.getElementById('progress');
const status = document.getElementById('status');
let selectedFiles = [];

dropZone.addEventListener('click', () => fileInput.click());
dropZone.addEventListener('dragover', (e) => {
e.preventDefault();
dropZone.classList.add('drag-over');
});
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
dropZone.addEventListener('drop', handleFiles);
fileInput.addEventListener('change', (e) => handleFiles(e));

function handleFiles(e) {
e.preventDefault();
dropZone.classList.remove('drag-over');

const files = e.dataTransfer ? Array.from(e.dataTransfer.files) : Array.from(e.target.files);
selectedFiles = files.filter(file => file.type.startsWith('image/'));

fileList.textContent = selectedFiles.length > 0 
? `${selectedFiles.length} فایل انتخاب شده` 
: 'هیچ فایلی انتخاب نشده';

processButton.disabled = selectedFiles.length === 0;
}

processButton.addEventListener('click', async () => {
processButton.disabled = true;
const width = parseInt(document.getElementById('width').value);
const height = parseInt(document.getElementById('height').value);
const format = document.getElementById('format').value;
const quality = parseInt(document.getElementById('quality').value) / 100;
const shouldZip = document.getElementById('zip').checked;

try {
const processed = [];
for (let i = 0; i < selectedFiles.length; i++) {
status.textContent = `در حال پردازش ${selectedFiles[i].name}...`;
progressBar.style.width = `${(i / selectedFiles.length) * 100}%`;

const processedImage = await processImage(selectedFiles[i], width, height, format, quality);
processed.push({
name: selectedFiles[i].name.split('.')[0] + '.' + format.split('/')[1],
data: processedImage
});
}

if (shouldZip) {
status.textContent = 'در حال ساخت فایل زیپ...';
const zip = new JSZip();
processed.forEach(file => {
zip.file(file.name, file.data.split(',')[1], {base64: true});
});

const content = await zip.generateAsync({type: 'blob'});
downloadFile(content, 'processed_images.zip');
} else {
processed.forEach(file => {
downloadFile(dataURItoBlob(file.data), file.name);
});
}

status.textContent = 'پردازش با موفقیت انجام شد';
progressBar.style.width = '100%';
} catch (error) {
status.textContent = `خطا: ${error.message}`;
}

processButton.disabled = false;
});

async function processImage(file, targetWidth, maxHeight, format, quality) {
return new Promise((resolve, reject) => {
const img = new Image();
const reader = new FileReader();

reader.onload = function(e) {
img.src = e.target.result;
};

img.onload = function() {
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');

let ratio = targetWidth / img.width;
let newHeight = img.height * ratio;

if (newHeight > maxHeight) {
newHeight = maxHeight;
ratio = maxHeight / img.height;
targetWidth = img.width * ratio;
}

canvas.width = targetWidth;
canvas.height = newHeight;

ctx.drawImage(img, 0, 0, targetWidth, newHeight);
resolve(canvas.toDataURL(format, quality));
};

img.onerror = reject;
reader.readAsDataURL(file);
});
}

function downloadFile(content, filename) {
const link = document.createElement('a');
link.href = URL.createObjectURL(content);
link.download = filename;
link.click();
URL.revokeObjectURL(link.href);
}

function dataURItoBlob(dataURI) {
const byteString = atob(dataURI.split(',')[1]);
const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
const ab = new ArrayBuffer(byteString.length);
const ia = new Uint8Array(ab);

for (let i = 0; i < byteString.length; i++) {
ia[i] = byteString.charCodeAt(i);
}

return new Blob([ab], {type: mimeString});
}
</script>
</body>
</html>
